<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="logo-tcg.png">
  <title>Connexion Maximus TCG</title>
  <link rel="stylesheet" href="css/index.css">
</head>
<body>
  <div class="background-jeux"></div>
  <div class="container">
    <h2>Connexion à Maximus TCG</h2>

    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required autocomplete="off">
      <input type="password" id="password" placeholder="Mot de passe" required autocomplete="off">
      <button type="submit">Se connecter / Créer compte</button>
    </form>

    <p style="margin-top: 20px; font-size: 0.9em; color: #aaa;">
      Pas de compte ? Utilise simplement le même formulaire !<br>
      (tout est stocké dans ton navigateur)
    </p>

    <p id="message" style="margin-top: 15px; font-weight: bold;"></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('loginForm');
      const message = document.getElementById('message');

      const savedEmail = localStorage.getItem('tcg_user_email');
      if (savedEmail) {
        message.style.color = '#0f0';
        message.textContent = `Bienvenue ${savedEmail.split('@')[0]} !`;
        setTimeout(() => {
          window.location.href = 'accueil.html';
        }, 1800);
        return;
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        const email = document.getElementById('email').value.trim().toLowerCase();
        const password = document.getElementById('password').value;

        if (!email || !password) {
          message.style.color = '#ff4444';
          message.textContent = 'Tous les champs sont requis';
          return;
        }

        const userKey = `tcg_user_${email}`;
        const existing = localStorage.getItem(userKey);

        if (existing) {
          const user = JSON.parse(existing);
          if (user.password === password) {
            localStorage.setItem('tcg_user_email', email);
            message.style.color = '#0f0';
            message.textContent = 'Connexion réussie !';
            setTimeout(() => window.location.href = 'accueil.html', 1200);
          } else {
            message.style.color = '#ff4444';
            message.textContent = 'Mot de passe incorrect';
          }
        } else {
          const newUser = { email, password, created: new Date().toISOString(), cards: [] };
          localStorage.setItem(userKey, JSON.stringify(newUser));
          localStorage.setItem('tcg_user_email', email);
          message.style.color = '#0f0';
          message.textContent = 'Compte créé ! Tu es connecté.';
          setTimeout(() => window.location.href = 'accueil.html', 1500);
        }
      });
    });

    window.logout = function() {
      localStorage.removeItem('tcg_user_email');
      window.location.href = 'index.html';
    };
  </script>
</body>
</html>
